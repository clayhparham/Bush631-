---
title: "Predicting Elections with Linear Models"
output:
  word_document: default
  pdf_document: default
Name: Clay Parham
---

Earlier in the chapter, we studied the prediction of election outcomes
using polls.  Here, we study the prediction of election outcomes based
on betting markets.  In particular, we analyze data for the 2008 and
2012 US presidential elections from the online betting company,
Intrade.  At Intrade, people trade contracts such as 'Obama to win
the electoral votes of Florida.'  Each contract's market price
fluctuates based on its sales.  Why might we expect betting markets
like Intrade to accurately predict the outcomes of elections or of
other events?  Some argue that the market can aggregate available
information efficiently.  In this exercise, we will test this 
*efficient market hypothesis* by analyzing the market prices of
contracts for Democratic and Republican nominees' victories in each
state.

The data files for 2008 is available in CSV format as
`intrade08.csv`. The variables in these datasets are:

 Name                Description
 ------------------- ---------------------------------------------------------
 `day`               Date of the session 
 `statename`         Full name of each state (including District of Columbia in 2008) 
 `state`             Abbreviation of each state (including District of Columbia in 2008)
 `PriceD`            Closing price (predicted vote share) of Democratic Nominee's market
 `PriceR`            Closing price (predicted vote share) of Republican Nominee's market 
 `VolumeD`           Total session trades of Democratic Party Nominee's market
 `VolumeR`           Total session trades of Republican Party Nominee's market 

Each row represents daily trading
information about the contracts for either the Democratic or
Republican Party nominee's victory in a particular state. 

We will also
use the election outcome data.  This data file is `pres08.csv` with variables:

 Name                 Description
 -------------------- ---------------------------------------------------------
 `state.name`         Full name of state (only in `pres2008`)
 `state`              Two letter state abbreviation
 `Obama`              Vote percentage for Obama
 `McCain`             Vote percentage for McCain
 `EV`                 Number of electoral college votes for this state
 
We'll also use poll data from 2008 in the file `polls08.csv`,  The variables in the polling data are:
  
 Name                 Description
 -------------------- ---------------------------------------------------------
 `state`              Abbreviated name of state in which poll was conducted 
 `Obama`              Predicted support for Obama (percentage)
 `Romney`             Predicted support for Romney (percentage) 
 `Pollster`           Name of organization conducting poll 
 `middate`            Middle of the period when poll was conducted 

```{r}
intrade08 <- read.csv("/Users/clayparham/Documents/Bush631-/Assignment 7/intrade08.csv")
intrade12 <- read.csv("/Users/clayparham/Documents/Bush631-/Assignment 7/intrade12.csv")
polls08 <- read.csv("/Users/clayparham/Documents/Bush631-/Assignment 7/polls08.csv")
polls12 <- read.csv("/Users/clayparham/Documents/Bush631-/Assignment 7/polls12.csv")
pres08 <- read.csv("/Users/clayparham/Documents/Bush631-/Assignment 7/pres08.csv")
pres12 <- read.csv("/Users/clayparham/Documents/Bush631-/Assignment 7/pres12.csv")
```

What is the relationship between the price margins of the Intrade market and the actual margin of victory? Using only the market data from the day before the election in 2008, regress Obama’s actual margin of victory in each state on Obama’s price margin from the Intrade markets. We’ll start by constructing Obama’s Intrade margin from 2008

## Question 1

Load the Intrade and Election outcome data for 2008 and merge them together.

Create a `DaysToElection` variable by subtracting the day of the election from each day in the dataset.  Now create a state margin of victory variable to predict, and a betting market margin to predict it with.

## Answer 1 

```{r}
pres08.merged <- merge(intrade08, pres08, by = "state")
pres08.merged$DaysToElection <- as.Date("2008-11-04") - as.Date(pres08.merged$day)
pres08.merged$marginvic <- pres08.merged$Obama - pres08.merged$McCain
pres08.merged$marginbet <- pres08.merged$PriceD - pres08.merged$PriceR

```

## Question 2

Considering only the trading one day from the election, predict the actual electoral margins from the trading margins using a linear model.  Does it predict well? How would you visualize the predictions and the outcomes together?  Hint: because we only have one predictor you can use `abline`.

## Answer 2

From the plot, we see that there is an S-shaped curve of the data. The data itself is fairly consistent within that S-shape, but it shows that in a lot of states the result was fairly well known before the election, and so betting markets naturally gravitated to support the side that would clearer be the victor. The regression itself has an intercept of -.5835. That is fairly close to 0, meaning that the midpoint of both the margin of victory and the margin of the betting markets were the same. However, as the margin of victory would increase by one, the regression tells us the margin of the bet would increase by 3.2, showing that the betting market increased  more rapidly than the margin of victory. There was one outlier, too, in the margin of victory for Obama that might slightly skew the data.
```{r}
LastDay08 <-subset(pres08.merged, subset = (day == "2008-11-03"))

lm(marginbet ~ marginvic, data = LastDay08)

plot(LastDay08$marginvic, LastDay08$marginbet, abline(lm(LastDay08$marginbet ~ LastDay08$marginvic)))
```

## Question 3

Even efficient markets aren’t omniscient. Information comes in about the election every day and the market prices should reflect any change in information that seem to matter to the outcome.

We can examine how and about what the markets change their minds by looking at which states they are confident about, and which they update their ‘opinions’ (i.e. their prices) about. Over the period before the election, let’s see how prices for each state are evolving. We can get a compact summary of price movement by fitting a linear model to Obama’s margin for each state over the 20 days before the election.

We will summarise price movement by the direction (up or down) and rate of change (large or small) of price over time. This is basically also what people in finance do, but they get paid more…

Start by plotting Obama’s margin in West Virginia against the number of days until the election and modeling the relationship with a linear model. [Hint: write your code using index notation. You then can copy it and paste it for the loop in the next question]. Use the last 20 days.  Show the model's predictions on each day and the data.  What does this model's slope coefficient tells us about which direction the margin is changing and also how fast it is changing? Hint: West Virginia is 50th [i<-50] on the alphabetical list of state names.

## Answer 3

We see in the data that as we get further out from the day of the election, the betting margin is closer in Obama's favor. This tells me that as you get further out from the election, the uncertainty factor increases substantially. The intercept is not entirely helpful in this case, but we do learn that the margin of the bet increases in Obama's favor by .2543 for each day further we get from the election.
```{r}
WV <- subset(pres08.merged,   subset =  (state == "WV" & DaysToElection <= 20))


plot(WV$DaysToElection, WV$marginbet, abline(lm(WV$marginbet ~ WV$DaysToElection)))
lm(WV$DaysToElection ~ WV$marginbet)


```

## Question 4 

Now do it for all states and collect the slop coefficients to see [historgram] how volative the state estimates are.

## Answer 4

```{r}

```



## Question 5

Now predict the winner of the election *one week before the election* using the Intrade data. To do so, first use the *two weeks before* that moment to fit state level linear models, then use those models to predict what will happen in each state.  How well does the model do predicting the election outcome? [present your results vs. actual margins in a confusion table to show your classification results - p. 136 and command table()]

## Answer 5

```{r}


```

